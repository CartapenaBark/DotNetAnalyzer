# MCP 工具测试指南

## 已实现的 8 个工具

### 1. 代码诊断工具
- **工具名称**: `get_diagnostics`
- **功能**: 获取 C# 代码的编译器诊断信息（错误、警告、信息）
- **状态**: ✅ 完整实现

**测试方法**:
```
使用场景：当你想要检查项目中的编译错误和警告时
参数：
- projectOrSolutionPath: 项目或解决方案的路径
- filePath (可选): 特定文件的路径

示例：
- 分析整个解决方案
- 分析单个项目文件
- 查看特定文件的诊断信息
```

### 2. 项目列表工具
- **工具名称**: `list_projects`
- **功能**: 列出解决方案中的所有项目
- **状态**: ✅ 完整实现

**测试方法**:
```
参数：
- solutionPath: 解决方案文件路径 (.sln)

返回：
- 项目名称
- 项目文件路径
- 程序集名称
- 是否包含文档
- 项目 ID
```

### 3. 项目信息工具
- **工具名称**: `get_project_info`
- **功能**: 获取项目的详细信息
- **状态**: ✅ 完整实现

**测试方法**:
```
参数：
- projectPath: 项目文件路径 (.csproj)

返回：
- 项目名称、路径、程序集名称
- 输出类型（Console App、Class Library 等）
- 语言（C#）
- 文档数量
- 诊断信息（错误数、警告数）
- 项目引用（Project References）
- 包引用（Package References）
```

### 4. 解决方案信息工具
- **工具名称**: `get_solution_info`
- **功能**: 获取解决方案的详细信息
- **状态**: ✅ 完整实现

**测试方法**:
```
参数：
- solutionPath: 解决方案文件路径 (.sln)

返回：
- 解决方案名称
- 解决方案文件路径
- 项目总数
- 所有项目的列表
```

### 5. 代码分析工具
- **工具名称**: `analyze_code`
- **功能**: 分析代码的语法和语义结构
- **状态**: ⚠️ 简化实现（基础文件信息）

**当前功能**:
- 文件是否存在
- 文件总行数
- 文件扩展名
- 文件大小

**测试方法**:
```
参数：
- filePath: 要分析的文件路径

注意：完整的语法树分析功能待实现
```

### 6. 符号引用查找工具
- **工具名称**: `find_references`
- **功能**: 查找符号的所有引用位置
- **状态**: ⚠️ 占位符实现

**当前行为**: 返回"功能开发中"的消息

**测试方法**:
```
参数：
- projectPath: 项目路径
- symbolName: 符号名称

注意：完整的引用查找功能待实现
```

### 7. 符号声明查找工具
- **工具名称**: `find_declarations`
- **功能**: 查找符号的声明位置
- **状态**: ⚠️ 占位符实现

**当前行为**: 返回"功能开发中"的消息

**测试方法**:
```
参数：
- projectPath: 项目路径
- symbolName: 符号名称

注意：完整的声明查找功能待实现
```

### 8. 符号信息工具
- **工具名称**: `get_symbol_info`
- **功能**: 获取符号的详细信息
- **状态**: ⚠️ 占位符实现

**当前行为**: 返回"功能开发中"的消息

**测试方法**:
```
参数：
- projectPath: 项目路径
- symbolName: 符号名称

注意：完整的符号信息获取功能待实现
```

## 测试步骤

### 1. 重新加载 VSCode
按 `Ctrl+Shift+P` → 输入 "Reload Window" → 选择 "Developer: Reload Window"

### 2. 测试项目管理工具
```
场景：获取当前解决方案的项目列表
对话示例：
"列出 DotNetAnalyzer 解决方案中的所有项目"

预期结果：
- 显示项目列表（DotNetAnalyzer.Cli、DotNetAnalyzer.Core 等）
- 每个项目的基本信息
```

### 3. 测试项目信息工具
```
场景：获取特定项目的详细信息
对话示例：
"获取 DotNetAnalyzer.Cli 项目的详细信息"

预期结果：
- 项目配置信息
- 项目引用列表
- 包引用列表
- 编译诊断（错误和警告）
```

### 4. 测试诊断工具
```
场景：检查项目的编译错误和警告
对话示例：
"检查 DotNetAnalyzer.Cli 项目的诊断信息"

预期结果：
- 所有编译错误（如果有）
- 所有警告
- 文件位置和行号
- 修复建议
```

### 5. 测试代码分析工具
```
场景：分析一个代码文件
对话示例：
"分析 Program.cs 文件"

预期结果：
- 文件基本信息（行数、大小）
- 注意：完整的语法树分析待实现
```

## 当前状态总结

### ✅ 完全可用的工具（4个）
1. `get_diagnostics` - 获取编译诊断
2. `list_projects` - 列出解决方案项目
3. `get_project_info` - 获取项目详细信息
4. `get_solution_info` - 获取解决方案信息

### ⚠️ 部分实现的工具（1个）
5. `analyze_code` - 代码分析（仅基础文件信息）

### 🔄 占位符实现的工具（3个）
6. `find_references` - 查找符号引用（待实现）
7. `find_declarations` - 查找符号声明（待实现）
8. `get_symbol_info` - 获取符号信息（待实现）

## 下一步工作

### 优先级 1: 完善基础工具
- 完善 `analyze_code` 工具，添加语法树分析

### 优先级 2: 实现符号查询功能
- 实现 `find_references` 工具
- 实现 `find_declarations` 工具
- 实现 `get_symbol_info` 工具

### 优先级 3: 增强功能
- 添加缓存失效检测（WorkspaceManager）
- 实现项目加载错误处理
- 添加性能优化

## 故障排除

### 问题 1: 工具无法调用
**解决方案**:
1. 确认 MCP 服务器正在运行
2. 检查 `.mcp.json` 配置
3. 重新加载 VSCode 窗口

### 问题 2: 项目加载失败
**解决方案**:
1. 确认项目路径正确
2. 确认项目文件存在
3. 检查项目是否有编译错误

### 问题 3: 工具返回错误
**解决方案**:
1. 查看错误消息
2. 检查参数是否正确
3. 查看日志输出（如果有）

## 反馈

如果遇到问题或有建议，请：
1. 记录错误消息
2. 记录复现步骤
3. 记录期望结果和实际结果
